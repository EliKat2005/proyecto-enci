{% extends 'base.html' %}
{% load static %}

{% block title %}Periodos Contables - {{ empresa.nombre }}{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  {% include 'contabilidad/_company_header_minimal.html' with current_panel='periodos' %}

  <div class="bg-white rounded-lg shadow-sm border border-slate-200 p-6 mt-6">
    <div class="flex items-center justify-between mb-4">
      <div>
        <h2 class="text-2xl font-bold text-slate-900">Gesti칩n de Periodos Contables</h2>
        <p class="text-sm text-slate-600">Empresa: {{ empresa.nombre }}</p>
      </div>
      <form method="post" class="flex items-center gap-2">{% csrf_token %}
        <input type="hidden" name="accion" value="crear_anio" />
        <input type="number" name="anio" value="{{ periodos.first.anio|default:current_year }}" class="px-3 py-2 border border-slate-300 rounded-lg text-sm" placeholder="A침o" />
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors">Crear periodos</button>
      </form>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead class="bg-slate-50 border-b border-slate-200 text-xs uppercase tracking-wide text-slate-600">
          <tr>
            <th class="px-4 py-3 text-left">A침o</th>
            <th class="px-4 py-3 text-left">Mes</th>
            <th class="px-4 py-3 text-left">Estado</th>
            <th class="px-4 py-3 text-left">Cerrado por</th>
            <th class="px-4 py-3 text-left">Fecha cierre</th>
            <th class="px-4 py-3 text-left">Acciones</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100">
          {% for p in periodos %}
          <tr>
            <td class="px-4 py-3">{{ p.anio }}</td>
            <td class="px-4 py-3">{% if p.mes > 0 %}{{ p.mes }}{% else %}Anual{% endif %}</td>
            <td class="px-4 py-3">
              {% if p.estado == 'ABIERTO' %}
                <span class="px-2 py-1 rounded bg-emerald-100 text-emerald-700">Abierto</span>
              {% elif p.estado == 'CERRADO' %}
                <span class="px-2 py-1 rounded bg-slate-200 text-slate-700">Cerrado</span>
              {% else %}
                <span class="px-2 py-1 rounded bg-amber-100 text-amber-700">Bloqueado</span>
              {% endif %}
            </td>
            <td class="px-4 py-3">{{ p.cerrado_por }}</td>
            <td class="px-4 py-3">{% if p.fecha_cierre %}{{ p.fecha_cierre|date:'d/m/Y H:i' }}{% else %}-{% endif %}</td>
            <td class="px-4 py-3">
              <form method="post" class="inline">{% csrf_token %}
                <input type="hidden" name="periodo_id" value="{{ p.id }}" />
                <input type="hidden" name="accion" value="abrir" />
                <button type="submit" class="px-3 py-1 rounded bg-emerald-600 text-white text-xs font-semibold hover:bg-emerald-700" {% if p.estado == 'ABIERTO' %}disabled class="opacity-50 cursor-not-allowed"{% endif %}>Abrir</button>
              </form>
              <form method="post" class="inline ml-2">{% csrf_token %}
                <input type="hidden" name="periodo_id" value="{{ p.id }}" />
                <input type="hidden" name="accion" value="cerrar" />
                <button type="submit" class="px-3 py-1 rounded bg-slate-700 text-white text-xs font-semibold hover:bg-slate-800" {% if p.estado == 'CERRADO' %}disabled class="opacity-50 cursor-not-allowed"{% endif %}>Cerrar</button>
              </form>
              <form method="post" class="inline ml-2">{% csrf_token %}
                <input type="hidden" name="periodo_id" value="{{ p.id }}" />
                <input type="hidden" name="accion" value="bloquear" />
                <button type="submit" class="px-3 py-1 rounded bg-amber-600 text-white text-xs font-semibold hover:bg-amber-700" {% if p.estado == 'BLOQUEADO' %}disabled class="opacity-50 cursor-not-allowed"{% endif %}>Bloquear</button>
              </form>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="px-4 py-8 text-center text-slate-500">No hay periodos registrados. Usa "Crear periodos" para generar el a침o.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
