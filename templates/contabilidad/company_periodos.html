{% extends 'base.html' %}
{% load static %}

{% block title %}Periodos Contables - {{ empresa.nombre }}{% endblock %}

{% block content %}
<div class="min-h-[calc(100vh-8rem)] bg-gradient-to-br from-slate-50 via-blue-50/30 to-slate-100 dark:from-black dark:via-slate-950 dark:to-slate-900 py-6">
  <div class="mx-auto px-4 xl:px-8 max-w-[1600px]">
    {% include 'contabilidad/_company_header_minimal.html' with current_panel='periodos' %}

    <div class="bg-white dark:bg-slate-900 rounded-lg shadow-sm border border-slate-200 dark:border-slate-800 p-4 mt-4">
      <div class="flex items-center justify-between mb-3">
        <div>
          <h2 class="text-lg font-bold text-slate-900 dark:text-gray-100">Gesti칩n de Periodos Contables</h2>
          <p class="text-sm text-slate-600 dark:text-slate-300">Empresa: {{ empresa.nombre }}</p>
        </div>
        <form method="post" class="flex items-center gap-2">{% csrf_token %}
          <input type="hidden" name="accion" value="crear_anio" />
          <input type="number" name="anio" value="{{ periodos.first.anio|default:current_year }}" class="px-3 py-2 border border-slate-300 dark:border-slate-700 dark:bg-slate-800 dark:text-gray-100 rounded-lg text-sm" placeholder="A침o" />
          <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition-colors">Crear periodos</button>
        </form>
      </div>

      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead class="bg-gradient-to-r from-slate-50 to-slate-100 dark:from-slate-800 dark:to-slate-900 border-b border-slate-200 dark:border-slate-700 text-xs uppercase tracking-wide text-slate-600 dark:text-slate-300">
            <tr>
              <th class="px-3 py-2 text-left">A침o</th>
              <th class="px-3 py-2 text-left">Mes</th>
              <th class="px-3 py-2 text-left">Estado</th>
              <th class="px-3 py-2 text-left">Cerrado por</th>
              <th class="px-3 py-2 text-left">Fecha cierre</th>
              <th class="px-3 py-2 text-left">Acciones</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-100 dark:divide-slate-800">
            {% for p in periodos %}
            <tr class="dark:text-slate-300">
              <td class="px-3 py-2">{{ p.anio }}</td>
              <td class="px-3 py-2">{% if p.mes > 0 %}{{ p.mes }}{% else %}Anual{% endif %}</td>
              <td class="px-3 py-2">
                {% if p.estado == 'ABIERTO' %}
                  <span class="px-2 py-1 rounded bg-emerald-100 dark:bg-emerald-950 text-emerald-700 dark:text-emerald-400">Abierto</span>
                {% elif p.estado == 'CERRADO' %}
                  <span class="px-2 py-1 rounded bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300">Cerrado</span>
                {% else %}
                  <span class="px-2 py-1 rounded bg-amber-100 dark:bg-amber-950 text-amber-700 dark:text-amber-400">Bloqueado</span>
                {% endif %}
              </td>
              <td class="px-3 py-2">{{ p.cerrado_por }}</td>
              <td class="px-3 py-2">{% if p.fecha_cierre %}{{ p.fecha_cierre|date:'d/m/Y H:i' }}{% else %}-{% endif %}</td>
              <td class="px-3 py-2">
                <form method="post" class="inline">{% csrf_token %}
                  <input type="hidden" name="periodo_id" value="{{ p.id }}" />
                  <input type="hidden" name="accion" value="abrir" />
                  <button type="submit" class="px-3 py-1 rounded bg-emerald-600 text-white text-xs font-semibold hover:bg-emerald-700" {% if p.estado == 'ABIERTO' %}disabled class="opacity-50 cursor-not-allowed"{% endif %}>Abrir</button>
                </form>
                <form method="post" class="inline ml-2">{% csrf_token %}
                  <input type="hidden" name="periodo_id" value="{{ p.id }}" />
                  <input type="hidden" name="accion" value="cerrar" />
                  <button type="submit" class="px-3 py-1 rounded bg-slate-700 text-white text-xs font-semibold hover:bg-slate-800" {% if p.estado == 'CERRADO' %}disabled class="opacity-50 cursor-not-allowed"{% endif %}>Cerrar</button>
              </form>
              <form method="post" class="inline ml-2">{% csrf_token %}
                <input type="hidden" name="periodo_id" value="{{ p.id }}" />
                <input type="hidden" name="accion" value="bloquear" />
                <button type="submit" class="px-3 py-1 rounded bg-amber-600 text-white text-xs font-semibold hover:bg-amber-700" {% if p.estado == 'BLOQUEADO' %}disabled class="opacity-50 cursor-not-allowed"{% endif %}>Bloquear</button>
              </form>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="px-4 py-8 text-center text-slate-500 dark:text-slate-400">No hay periodos registrados. Usa "Crear periodos" para generar el a침o.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
