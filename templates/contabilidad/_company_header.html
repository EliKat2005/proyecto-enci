{% comment %}Unified company header: expects empresa, current_panel, can_edit, is_docente, user in context{% endcomment %}
<div class="bg-gradient-to-r from-white via-slate-50/30 to-white dark:from-slate-900 dark:via-slate-900/30 dark:to-slate-900 px-6 py-5 rounded-xl shadow-lg border border-slate-200/60 dark:border-slate-800 flex flex-wrap items-start justify-between gap-6 relative overflow-hidden">
  <div class="absolute inset-0 bg-gradient-to-br from-blue-500/5 via-transparent to-purple-500/5 dark:from-blue-500/10 dark:to-purple-500/10 pointer-events-none"></div>
  <div class="flex items-start gap-4 min-w-[280px] relative z-10">
    <div class="w-16 h-16 rounded-2xl flex items-center justify-center bg-gradient-to-br from-blue-600 via-blue-700 to-blue-800 dark:from-blue-700 dark:via-blue-800 dark:to-blue-900 shadow-xl border-2 border-blue-400/20 dark:border-blue-600/20">
      <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
      </svg>
    </div>
    <div class="flex-1">
      <h1 class="text-2xl font-bold tracking-tight text-slate-900 dark:text-slate-100 mb-1">{{ empresa.nombre }}</h1>
      <p class="text-sm text-slate-600 dark:text-slate-400 line-clamp-2 leading-relaxed">{{ empresa.descripcion|default:'Sin descripciÃ³n' }}</p>
      <div class="mt-3 flex flex-wrap gap-2 text-xs">
        <span class="flex items-center gap-1.5 px-2.5 py-1 bg-blue-50 dark:bg-blue-950 text-blue-700 dark:text-blue-400 rounded-lg font-medium border border-blue-200/50 dark:border-blue-900/50">
          <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
          {% if empresa.original and empresa.original.owner %}{{ empresa.original.owner.get_full_name|default:empresa.original.owner.username }}{% else %}{{ empresa.owner.get_full_name|default:empresa.owner.username }}{% endif %}
        </span>
        <span class="flex items-center gap-1.5 px-2.5 py-1 bg-emerald-50 dark:bg-emerald-950 text-emerald-700 dark:text-emerald-400 rounded-lg font-medium border border-emerald-200/50 dark:border-emerald-900/50">
          <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
          {% if empresa.original and empresa.original.created_at %}{{ empresa.original.created_at|date:'d/m/Y' }}{% else %}{{ empresa.created_at|date:'d/m/Y' }}{% endif %}
        </span>
        <span class="flex items-center gap-1.5 px-2.5 py-1 bg-purple-50 dark:bg-purple-950 text-purple-700 dark:text-purple-400 rounded-lg font-medium border border-purple-200/50 dark:border-purple-900/50">
          <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
          {{ empresa.asientos.count }} asientos
        </span>
      </div>
    </div>
  </div>
  <div class="flex flex-col gap-2.5 items-end relative z-10">
    <div class="flex gap-2">
      {% if can_edit %}
        <a href="{% url 'contabilidad:edit_company' empresa.id %}" class="px-4 py-2 text-xs font-semibold rounded-lg bg-gradient-to-r from-emerald-600 to-emerald-700 dark:from-emerald-700 dark:to-emerald-800 hover:from-emerald-700 hover:to-emerald-800 dark:hover:from-emerald-600 dark:hover:to-emerald-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 flex items-center gap-1.5">
          <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
          Editar
        </a>
        <a href="{% url 'contabilidad:delete_company' empresa.id %}" class="px-4 py-2 text-xs font-semibold rounded-lg bg-gradient-to-r from-red-600 to-red-700 dark:from-red-700 dark:to-red-800 hover:from-red-700 hover:to-red-800 dark:hover:from-red-600 dark:hover:to-red-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 flex items-center gap-1.5">
          <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
          Eliminar
        </a>
      {% endif %}
    </div>
    <a href="{% url 'contabilidad:my_companies' %}" class="px-4 py-2 text-xs font-semibold rounded-lg bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-200 border-2 border-slate-200 dark:border-slate-700 hover:border-slate-300 dark:hover:border-slate-600 transition-all duration-200 flex items-center gap-1.5 shadow-sm hover:shadow-md">
      <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>
      Volver a Empresas
    </a>
  </div>
</div>

{% if current_panel != 'detalle' %}
<nav class="mt-4 mb-6">
  <div class="bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm p-2 rounded-xl shadow-md border border-slate-200/60 dark:border-slate-800 inline-flex flex-wrap gap-1">
    <a href="{% url 'contabilidad:company_detail' empresa.id %}" class="px-4 py-2 rounded-lg text-xs font-semibold transition-all duration-200
      {% if current_panel == 'detalle' %}bg-gradient-to-r from-indigo-600 to-indigo-700 dark:from-indigo-700 dark:to-indigo-800 text-white shadow-lg scale-105{% else %}text-slate-700 dark:text-slate-300 hover:bg-indigo-50 dark:hover:bg-indigo-950 hover:text-indigo-700 dark:hover:text-indigo-400{% endif %}">Resumen</a>
    <a href="{% url 'contabilidad:company_plan' empresa.id %}" class="px-4 py-2 rounded-lg text-xs font-semibold transition-all duration-200
      {% if current_panel == 'plan' %}bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-700 dark:to-blue-800 text-white shadow-lg scale-105{% else %}text-slate-700 dark:text-slate-300 hover:bg-blue-50 dark:hover:bg-blue-950 hover:text-blue-700 dark:hover:text-blue-400{% endif %}">Plan de Cuentas</a>
    <a href="{% url 'contabilidad:company_diario' empresa.id %}" class="px-4 py-2 rounded-lg text-xs font-semibold transition-all duration-200
      {% if current_panel == 'diario' %}bg-gradient-to-r from-emerald-600 to-emerald-700 dark:from-emerald-700 dark:to-emerald-800 text-white shadow-lg scale-105{% else %}text-slate-700 dark:text-slate-300 hover:bg-emerald-50 dark:hover:bg-emerald-950 hover:text-emerald-700 dark:hover:text-emerald-400{% endif %}">Libro Diario</a>
    <a href="{% url 'contabilidad:company_mayor' empresa.id %}" class="px-4 py-2 rounded-lg text-xs font-semibold transition-all duration-200
      {% if current_panel == 'mayor' %}bg-gradient-to-r from-purple-600 to-purple-700 dark:from-purple-700 dark:to-purple-800 text-white shadow-lg scale-105{% else %}text-slate-700 dark:text-slate-300 hover:bg-purple-50 dark:hover:bg-purple-950 hover:text-purple-700 dark:hover:text-purple-400{% endif %}">Libro Mayor</a>
    <a href="{% url 'contabilidad:company_balance_comprobacion' empresa.id %}" class="px-4 py-2 rounded-lg text-xs font-semibold transition-all duration-200
      {% if current_panel == 'balance' %}bg-gradient-to-r from-amber-600 to-amber-700 dark:from-amber-700 dark:to-amber-800 text-white shadow-lg scale-105{% else %}text-slate-700 dark:text-slate-300 hover:bg-amber-50 dark:hover:bg-amber-950 hover:text-amber-700 dark:hover:text-amber-400{% endif %}">Balance</a>
    <a href="{% url 'contabilidad:company_estados_financieros' empresa.id %}" class="px-4 py-2 rounded-lg text-xs font-semibold transition-all duration-200
      {% if current_panel == 'estados' %}bg-gradient-to-r from-rose-600 to-rose-700 dark:from-rose-700 dark:to-rose-800 text-white shadow-lg scale-105{% else %}text-slate-700 dark:text-slate-300 hover:bg-rose-50 dark:hover:bg-rose-950 hover:text-rose-700 dark:hover:text-rose-400{% endif %}">Estados</a>
    <a href="{% url 'contabilidad:kardex_lista_productos' empresa.id %}" class="px-4 py-2 rounded-lg text-xs font-semibold transition-all duration-200
      {% if current_panel == 'kardex' %}bg-gradient-to-r from-cyan-600 to-cyan-700 dark:from-cyan-700 dark:to-cyan-800 text-white shadow-lg scale-105{% else %}text-slate-700 dark:text-slate-300 hover:bg-cyan-50 dark:hover:bg-cyan-950 hover:text-cyan-700 dark:hover:text-cyan-400{% endif %}">ðŸ“¦ Kardex</a>
    <a href="{% url 'contabilidad:ml_dashboard' empresa.id %}" class="px-4 py-2 rounded-lg text-xs font-semibold transition-all duration-200
      {% if current_panel == 'ml_dashboard' %}bg-gradient-to-r from-teal-600 to-teal-700 dark:from-teal-700 dark:to-teal-800 text-white shadow-lg scale-105{% else %}text-slate-700 dark:text-slate-300 hover:bg-teal-50 dark:hover:bg-teal-950 hover:text-teal-700 dark:hover:text-teal-400{% endif %}">ðŸ¤– ML/AI</a>
  </div>
</nav>
{% endif %}
